<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LSB-163 - Cửa hàng Điện tử</title>
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/client/lib/lightbox/css/lightbox.min.css" rel="stylesheet">
    <link href="/client/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="/client/css/bootstrap.min.css" rel="stylesheet">
    <link href="/client/css/style.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #007bff;
            --light-gray: #f8f9fa;
            --text-dark: #333;
            --text-muted: #777;
        }

        /* ===== 1. Product Card Styles (Ghi đè style cũ bằng !important) ===== */
        .product-card {
            border: none !important;
            border-radius: 15px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05) !important;
            transition: all 0.3s ease !important;
            height: 100% !important;
            display: flex !important;
            flex-direction: column !important;
            background-color: #fff !important;
            overflow: hidden !important;
        }

        .product-card:hover {
            transform: translateY(-5px) !important;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1) !important;
        }

        .product-img-container {
            position: relative !important;
            overflow: hidden !important;
            padding-top: 100%; /* Aspect ratio 1:1 container */
            width: 100%;
        }

        .product-card .card-img-top {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain !important; /* Hoặc cover tùy ảnh */
            padding: 1rem;
            transition: transform 0.3s ease;
        }

        .product-card:hover .card-img-top {
            transform: scale(1.05);
        }

        .product-card .card-body {
            display: flex !important;
            flex-direction: column !important;
            flex-grow: 1 !important;
            padding: 1.25rem !important;
        }

        .product-card .card-title {
            font-size: 1rem !important;
            font-weight: 600 !important;
            color: var(--text-dark) !important;
            display: -webkit-box !important;
            -webkit-line-clamp: 2 !important;
            -webkit-box-orient: vertical !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            height: 3rem !important;
            margin-bottom: 0.5rem !important;
        }

        .product-card .card-title a {
            color: inherit;
            text-decoration: none;
        }

        .product-card .card-title a:hover {
            color: var(--primary-color);
        }

        .product-card .card-text {
            font-size: 0.85rem !important;
            color: var(--text-muted) !important;
            flex-grow: 1 !important;
            margin-bottom: 1rem !important;
        }

        .product-card .product-price {
            font-size: 1.25rem !important;
            font-weight: 700 !important;
            color: var(--primary-color) !important;
            margin-bottom: 0.75rem !important;
        }

        .product-card .product-tag {
            top: 10px !important;
            left: 10px !important;
            font-size: 0.75rem !important;
            font-weight: 600 !important;
            padding: 4px 10px !important;
            border-radius: 20px !important;
            background-color: var(--primary-color) !important;
            color: #fff !important;
            z-index: 2;
        }

        /* Nút Xem nhanh */
        .btn-quick-view {
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) scale(0) !important;
            background-color: rgba(255, 255, 255, 0.9) !important;
            color: var(--primary-color) !important;
            border: none !important;
            border-radius: 50% !important;
            width: 45px !important;
            height: 45px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            opacity: 0 !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 3;
            cursor: pointer;
        }

        .product-card:hover .btn-quick-view {
            transform: translate(-50%, -50%) scale(1) !important;
            opacity: 1 !important;
        }

        /* Nút Add to Cart */
        .btn-add-to-cart {
            background-color: var(--primary-color) !important;
            color: white !important;
            border: none !important;
            border-radius: 50px !important;
            font-weight: 600 !important;
            padding: 8px 0 !important;
            transition: background-color 0.2s ease !important;
            width: 100%;
        }

        .btn-add-to-cart:hover {
            background-color: #0056b3 !important;
        }

        /* ===== 2. New Sections CSS ===== */

        /* Category Bar */
        .category-nav-bar {
            background-color: #fff;
            border: 1px solid #e9e9ea;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            justify-content: space-between; /* or start/center */
            gap: 10px;
            align-items: center;
            overflow-x: auto;
            white-space: nowrap;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        .category-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            color: var(--text-dark);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            min-width: 80px;
        }

        .category-nav-item i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-muted);
            transition: color 0.2s ease;
        }

        .category-nav-item span {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .category-nav-item:hover, .category-nav-item.active {
            background-color: #f0f7ff; /* Light blue bg */
            color: var(--primary-color);
        }

        .category-nav-item:hover i, .category-nav-item.active i {
            color: var(--primary-color);
        }

        /* Promo Banners */
        .promo-banner img {
            border-radius: 12px;
            width: 100%;
            height: auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        .promo-banner:hover img {
            transform: translateY(-3px);
        }

        /* Filter Sections */
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-dark);
            position: relative;
            padding-left: 15px;
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 20px;
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        /* Brand Chips */
        .brand-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .brand-chip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #e9e9ea;
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            min-width: 80px;
        }

        .brand-chip:hover, .brand-chip.active {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
            color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,123,255,0.1);
        }

        /* Need/Target Filter */
        .need-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem 1rem;
            text-align: center;
            text-decoration: none;
            color: var(--text-dark);
            display: block;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            height: 100%;
        }

        .need-card:hover {
            background: #fff;
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transform: translateY(-3px);
            color: var(--primary-color);
        }

        .need-card img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 0.75rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .need-card span {
            font-weight: 600;
            font-size: 0.9rem;
            display: block;
        }

        /* Sticky Filter */
        .product-filter-bar {
            padding: 1rem 0;
            background: #fff;
            border-bottom: 1px solid #eee;
            margin-bottom: 2rem;
        }

        .sticky-filter {
            position: fixed;
            top: 90px; /* Height of main navbar */
            left: 0;
            right: 0;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .nav-pills .nav-link {
            color: var(--text-muted);
            font-weight: 600;
            padding: 0.5rem 1.25rem;
            border-radius: 20px;
            margin: 0 5px;
            transition: all 0.2s;
        }

        .nav-pills .nav-link:hover {
            background-color: #e9ecef;
            color: var(--text-dark);
        }

        .nav-pills .nav-link.active {
            background-color: var(--primary-color);
            color: #fff;
        }

        /* Search Results */
        .search-result-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
            text-decoration: none;
            color: var(--text-dark);
        }
        .search-result-item:hover {
            background-color: #f8f9fa;
        }
        .search-result-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
        }
    </style>
</head>
<body>

<!-- Spinner -->
<div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
    <div class="spinner-grow text-primary" role="status"></div>
</div>

<!-- Header -->
<div th:replace="~{client/layout/header :: header}"></div>

<!-- Modal Search -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content rounded-0">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Tìm kiếm sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex align-items-center flex-column">
                <div class="input-group w-75 mx-auto d-flex mb-4">
                    <input id="search-keyword" type="search" class="form-control p-3" placeholder="Nhập tên sản phẩm..." aria-describedby="search-icon-1">
                    <span id="search-icon-1" class="input-group-text p-3"><i class="fa fa-search"></i></span>
                </div>
                <div id="search-results" class="w-75" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>
</div>

<!-- Banner -->
<div th:replace="~{client/layout/banner :: banner}"></div>

<!-- Chatbot -->
<div th:replace="~{client/layout/chatbot :: chatbot}"></div>


<!-- ===== PHẦN GIAO DIỆN MỚI (CATEGORIES, BANNERS, FILTERS) ===== -->
<div class="container py-5">

    <!-- 1. Category Bar (Icon Danh mục) -->
    <div class="category-nav-bar">
        <a href="#" class="category-nav-item active">
            <i class="fas fa-laptop"></i>
            <span>Laptop</span>
        </a>
        <a href="#" class="category-nav-item">
            <i class="fas fa-desktop"></i>
            <span>PC</span>
        </a>
        <a href="#" class="category-nav-item">
            <i class="fas fa-tv"></i>
            <span>Màn hình</span>
        </a>
        <a href="#" class="category-nav-item">
            <i class="fas fa-tools"></i>
            <span>Build PC</span>
        </a>
        <a href="#" class="category-nav-item">
            <i class="fas fa-microchip"></i>
            <span>Linh kiện</span>
        </a>
        <a href="#" class="category-nav-item">
            <i class="fas fa-print"></i>
            <span>Máy in</span>
        </a>
        <a href="#" class="category-nav-item">
            <i class="fas fa-keyboard"></i>
            <span>Phụ kiện</span>
        </a>
    </div>

    <!-- 2. Promo Banners -->
    <div class="row g-4 mb-5">
        <div class="col-md-6">
            <a href="#" class="promo-banner">
                <!-- Placeholder Image (Thay bằng ảnh thật của bạn) -->
                <img src="https://placehold.co/600x150/111/FFF?text=Khuyen+Mai+Laptop+Gaming" alt="Banner 1">
            </a>
        </div>
        <div class="col-md-6">
            <a href="#" class="promo-banner">
                <img src="https://placehold.co/600x150/007bff/FFF?text=Giam+Gia+Sinh+Vien" alt="Banner 2">
            </a>
        </div>
    </div>

    <!-- 3. Brand Filter (Lọc theo Hãng) -->
    <div class="mb-5">
        <h3 class="section-title">Thương hiệu nổi bật</h3>
        <div class="brand-filter">
            <a href="#" class="brand-chip active">Tất cả</a>
            <a href="#" class="brand-chip">MacBook</a>
            <a href="#" class="brand-chip">ASUS</a>
            <a href="#" class="brand-chip">Lenovo</a>
            <a href="#" class="brand-chip">MSI</a>
            <a href="#" class="brand-chip">Acer</a>
            <a href="#" class="brand-chip">Dell</a>
            <a href="#" class="brand-chip">HP</a>
            <a href="#" class="brand-chip">LG</a>
        </div>
    </div>

    <!-- 4. Needs Filter (Lọc theo Nhu cầu) -->
    <div class="mb-5">
        <h3 class="section-title">Chọn theo nhu cầu</h3>
        <div class="row g-3">
            <div class="col-6 col-md-4 col-lg-2">
                <a href="#" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/3003/3003202.png" alt="Văn phòng">
                    <span>Văn phòng</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a href="#" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/808/808439.png" alt="Gaming">
                    <span>Gaming</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a href="#" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/2919/2919600.png" alt="Mỏng nhẹ">
                    <span>Mỏng nhẹ</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a href="#" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/1995/1995485.png" alt="Đồ họa">
                    <span>Đồ họa</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a href="#" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/201/201614.png" alt="Sinh viên">
                    <span>Sinh viên</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a href="#" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/954/954591.png" alt="Cao cấp">
                    <span>Cao cấp</span>
                </a>
            </div>
        </div>
    </div>

</div>
<!-- ===== KẾT THÚC GIAO DIỆN MỚI ===== -->


<!-- ===== SẢN PHẨM & GỢI Ý ===== -->

<!-- 1. Gợi ý AI (Dành riêng cho bạn) -->
<div class="container-fluid fruite py-4 bg-light" th:if="${recommendedProducts != null and not #lists.isEmpty(recommendedProducts)}">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-12">
                <h2 class="mb-4 section-title" th:text="${recommendTitle}">Gợi ý</h2>
                <div class="owl-carousel product-carousel">
                    <div class="item" th:each="product : ${recommendedProducts}">
                        <!-- START CARD -->
                        <div class="card product-card">
                            <div class="product-img-container">
                                <img th:src="@{'/images/product/' + ${product.image}}" class="card-img-top" th:alt="${product.name}">
                                <!-- Nút Quick View -->
                                <a href="#" class="btn-quick-view"
                                   data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                   th:attr="data-name=${product.name},
                                            data-price=${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ',
                                            data-image=@{'/images/product/' + ${product.image}},
                                            data-desc=${product.shortDesc},
                                            data-id=${product.id}">
                                    <i class="fa fa-eye"></i>
                                </a>
                            </div>
                            <div class="text-white bg-secondary product-tag rounded position-absolute">
                                <span th:text="${product.category != null ? product.category.name : 'Hot'}"></span>
                            </div>

                            <div class="card-body">
                                <h5 class="card-title">
                                    <a th:href="@{'/product/' + ${product.id}}" class="text-decoration-none" th:text="${product.name}"></a>
                                </h5>
                                <p class="card-text" th:text="${product.shortDesc}"></p>

                                <div class="mt-auto">
                                    <p class="product-price"
                                       th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></p>

                                    <!-- Form Add to Cart (Redirect) -->
                                    <form th:action="@{/add-product-to-cart/{id}(id=${product.id})}" method="post">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                        <button class="btn btn-add-to-cart" type="submit">
                                            <i class="fa fa-shopping-bag me-2"></i> Thêm vào giỏ
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <!-- END CARD -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 2. Sản phẩm Chính (Có Lọc & Sticky) -->
<div class="container-fluid fruite py-5">
    <div class="container py-5">
        <div class="tab-class text-center">

            <div class="row g-4">
                <div class="col-lg-12 text-start">
                    <h1>Sản Phẩm Mới Nhất</h1>
                </div>
            </div>

            <!-- Sticky Filter Bar -->
            <div id="product-filter-bar" class="product-filter-bar">
                <ul class="nav nav-pills d-inline-flex text-center mb-0">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="pill" href="#tab-0">Tất cả</a>
                    </li>
                    <li class="nav-item" th:each="cat : ${categories}">
                        <a class="nav-link" data-bs-toggle="pill" th:href="@{|#tab-${cat.id}|}" th:text="${cat.name}"></a>
                    </li>
                </ul>
            </div>
            <div id="filter-placeholder" class="filter-placeholder"></div>

            <!-- Tab Content -->
            <div class="tab-content mt-4">
                <!-- Tab All -->
                <div id="tab-0" class="tab-pane fade show p-0 active">
                    <div class="row g-4">
                        <div class="col-md-6 col-lg-4 col-xl-3" th:each="product : ${products}">
                            <!-- START CARD (Copy giống hệt ở trên) -->
                            <div class="card product-card">
                                <div class="product-img-container">
                                    <img th:src="@{'/images/product/' + ${product.image}}" class="card-img-top" th:alt="${product.name}">
                                    <a href="#" class="btn-quick-view"
                                       data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                       th:attr="data-name=${product.name},
                                                data-price=${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ',
                                                data-image=@{'/images/product/' + ${product.image}},
                                                data-desc=${product.shortDesc},
                                                data-id=${product.id}">
                                        <i class="fa fa-eye"></i>
                                    </a>
                                </div>
                                <div class="text-white bg-secondary product-tag rounded position-absolute">
                                    <span th:text="${product.category != null ? product.category.name : 'Mới'}"></span>
                                </div>

                                <div class="card-body">
                                    <h5 class="card-title">
                                        <a th:href="@{'/product/' + ${product.id}}" class="text-decoration-none" th:text="${product.name}"></a>
                                    </h5>
                                    <p class="card-text" th:text="${product.shortDesc}"></p>
                                    <div class="mt-auto">
                                        <p class="product-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></p>
                                        <form th:action="@{/add-product-to-cart/{id}(id=${product.id})}" method="post">
                                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                            <button class="btn btn-add-to-cart" type="submit">
                                                <i class="fa fa-shopping-bag me-2"></i> Thêm vào giỏ
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- END CARD -->
                        </div>
                    </div>
                </div>

                <!-- Category Tabs -->
                <div th:each="cat : ${categories}" th:id="@{|tab-${cat.id}|}" class="tab-pane fade show p-0">
                    <div class="row g-4">
                        <div class="col-md-6 col-lg-4 col-xl-3"
                             th:each="product : ${products}"
                             th:if="${product.category != null and product.category.id == cat.id}">

                            <!-- START CARD -->
                            <div class="card product-card">
                                <div class="product-img-container">
                                    <img th:src="@{'/images/product/' + ${product.image}}" class="card-img-top" th:alt="${product.name}">
                                    <a href="#" class="btn-quick-view"
                                       data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                       th:attr="data-name=${product.name},
                                                data-price=${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ',
                                                data-image=@{'/images/product/' + ${product.image}},
                                                data-desc=${product.shortDesc},
                                                data-id=${product.id}">
                                        <i class="fa fa-eye"></i>
                                    </a>
                                </div>
                                <div class="text-white bg-secondary product-tag rounded position-absolute">
                                    <span th:text="${cat.name}"></span>
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <a th:href="@{'/product/' + ${product.id}}" class="text-decoration-none" th:text="${product.name}"></a>
                                    </h5>
                                    <p class="card-text" th:text="${product.shortDesc}"></p>
                                    <div class="mt-auto">
                                        <p class="product-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></p>
                                        <form th:action="@{/add-product-to-cart/{id}(id=${product.id})}" method="post">
                                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                            <button class="btn btn-add-to-cart" type="submit">
                                                <i class="fa fa-shopping-bag me-2"></i> Thêm vào giỏ
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- END CARD -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Feature, Footer (Giữ nguyên) -->
<div th:replace="~{client/layout/feature :: feature}"></div>
<div th:replace="~{client/layout/footer :: footer}"></div>
<a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top"><i class="fa fa-arrow-up"></i></a>

<!-- Modal Quick View (Giữ nguyên) -->
<div class="modal fade" id="quickViewModal" tabindex="-1" aria-labelledby="quickViewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quickViewModalLabel">Chi tiết sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-5">
                        <img id="quickViewImage" src="" class="img-fluid rounded w-100" alt="Product Image">
                    </div>
                    <div class="col-md-7">
                        <h3 id="quickViewName"></h3>
                        <p id="quickViewPrice" class="fs-3 fw-bold text-primary"></p>
                        <p id="quickViewDesc"></p>

                        <!-- Quick View Form Add to Cart -->
                        <form id="quickViewForm" method="post" action="">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button class="btn btn-primary w-100 mt-3" type="submit">
                                <i class="fa fa-shopping-bag me-2"></i> Thêm vào giỏ ngay
                            </button>
                        </form>

                        <a href="#" id="quickViewFullDetails" class="btn btn-outline-secondary w-100 mt-2">Xem chi tiết đầy đủ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- JavaScript Libraries (Giữ nguyên) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/client/lib/easing/easing.min.js"></script>
<script src="/client/lib/waypoints/waypoints.min.js"></script>
<script src="/client/lib/lightbox/js/lightbox.min.js"></script>
<script src="/client/lib/owlcarousel/owl.carousel.min.js"></script>
<script src="/client/js/main.js"></script>

<script th:inline="javascript">
    /*<![CDATA[*/

    // --- 1. Quick View Logic ---
    var quickViewModal = document.getElementById('quickViewModal');
    quickViewModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;

        var name = button.getAttribute('data-name');
        var price = button.getAttribute('data-price');
        var image = button.getAttribute('data-image');
        var desc = button.getAttribute('data-desc');
        var id = button.getAttribute('data-id');

        // Update content
        document.getElementById('quickViewName').textContent = name;
        document.getElementById('quickViewPrice').textContent = price;
        document.getElementById('quickViewImage').src = image;
        document.getElementById('quickViewDesc').textContent = desc;
        document.getElementById('quickViewFullDetails').href = '/product/' + id;

        // Update form action
        document.getElementById('quickViewForm').action = '/add-product-to-cart/' + id;
    });


    // --- 2. Search Logic (Giữ nguyên) ---
    let debounceTimer;
    document.getElementById("search-keyword").addEventListener("input", function () {
        const keyword = this.value.trim();
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            if (keyword.length >= 2) {
                fetch("/api/search?keyword=" + encodeURIComponent(keyword))
                .then(response => response.json())
                .then(data => {
                    const resultsDiv = document.getElementById("search-results");
                    if (!resultsDiv) return;

                    if (data.length === 0) {
                        resultsDiv.innerHTML = "<p class='text-center text-muted p-2'>Không tìm thấy kết quả</p>";
                        return;
                    }

                    resultsDiv.innerHTML = data.map(product => `
                        <a href="/product/${product.id}" class="search-result-item text-decoration-none">
                            <img src="/images/product/${product.image}" alt="${product.name}">
                            <div class="search-result-info">
                                <strong>${product.name}</strong><br/>
                                <small>${product.shortDesc}</small>
                            </div>
                        </a>
                    `).join('');
                })
                .catch(error => console.error("Lỗi:", error));
            } else {
                 const resultsDiv = document.getElementById("search-results");
                 if (resultsDiv) resultsDiv.innerHTML = "";
            }
        }, 500);
    });

    // --- 3. Owl Carousel & Sticky Filter ---
    (function ($) {
        "use strict";

        // Product Carousel
        $('.product-carousel').owlCarousel({
            autoplay: true,
            smartSpeed: 1000,
            center: false,
            dots: true,
            loop: true,
            margin: 25,
            nav : false,
            responsiveClass: true,
            responsive: {
                0:{ items:1 },
                576:{ items:1 },
                768:{ items:2 },
                992:{ items:3 },
                1200:{ items:4 }
            }
        });

        // Sticky Filter
        $(window).scroll(function() {
            var header = $('.fixed-top');
            var filterBar = $('#product-filter-bar');
            var placeholder = $('#filter-placeholder');

            if (header.length && filterBar.length && placeholder.length) {
                var headerHeight = header.outerHeight() || 90;
                var filterBarOffset = filterBar.offset().top;
                placeholder.height(filterBar.outerHeight());

                if ($(window).scrollTop() > (filterBarOffset - headerHeight)) {
                    filterBar.addClass('sticky-filter');
                    filterBar.css('top', headerHeight + 'px');
                    placeholder.show();
                } else {
                    filterBar.removeClass('sticky-filter');
                    placeholder.hide();
                }
            }
        });

    })(jQuery);
    /*]]>*/
</script>

</body>
</html>