<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LSB-163 - Cửa hàng Điện tử</title>

    <!-- Meta CSRF -->
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/client/lib/lightbox/css/lightbox.min.css" rel="stylesheet">
    <link href="/client/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="/client/css/bootstrap.min.css" rel="stylesheet">
    <link href="/client/css/style.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #007bff;
            --light-gray: #f8f9fa;
            --text-dark: #111827;
            --text-muted: #6b7280;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --hover-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* Nền sáng nhẹ cho toàn trang */
        }

        /* Section Spacing */
        section {
            margin-bottom: 3rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            position: relative;
            padding-left: 1rem;
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 24px;
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        /* Category Nav Bar */
        .category-nav-bar {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
        }
        .category-nav-bar::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }
        .category-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 70px;
            text-decoration: none;
            color: var(--text-muted);
            transition: all 0.2s;
        }
        .category-nav-item i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .category-nav-item span {
            font-size: 0.8rem;
            font-weight: 600;
        }
        .category-nav-item:hover, .category-nav-item.active {
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* Product Card Refined */
        .product-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            transition: all 0.3s ease;
            height: 100%;
            overflow: hidden;
        }
        .product-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--hover-shadow);
            transform: translateY(-4px);
        }
        .product-img-container {
            position: relative;
            padding-top: 100%;
            background: #fff;
        }
        .card-img-top {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: contain;
            padding: 1.5rem;
            transition: transform 0.3s;
        }
        .product-card:hover .card-img-top {
            transform: scale(1.05);
        }
        .product-tag {
            position: absolute;
            top: 10px; left: 10px;
            background: var(--primary-color);
            color: white;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 2;
        }
        .card-body {
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        .card-title a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            transition: color 0.2s;
        }
        .card-title a:hover {
            color: var(--primary-color);
        }
        .card-text {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        .product-price {
            color: #dc2626; /* Red price */
            font-weight: 700;
            font-size: 1.1rem;
        }
        .btn-add-to-cart {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 6px;
            width: 100%;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-add-to-cart:hover {
            background: #0056b3;
        }

        /* Quick View Button */
        .btn-quick-view {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 40px; height: 40px;
            background: white;
            color: var(--text-dark);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            opacity: 0;
            transition: all 0.3s;
            z-index: 3;
        }
        .product-card:hover .btn-quick-view {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        .btn-quick-view:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Sticky Filter Bar */
        .product-filter-bar {
            background: white;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
            z-index: 990;
        }
        .sticky-filter {
            position: fixed;
            top: 90px; /* Adjust based on header height */
            left: 0; right: 0;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }

        .nav-pills .nav-link {
            color: var(--text-muted);
            border-radius: 20px;
            padding: 6px 16px;
            margin-right: 8px;
            font-weight: 500;
        }
        .nav-pills .nav-link.active, .nav-pills .nav-link:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Needs Cards */
        .need-card {
            display: block;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem 1rem;
            text-align: center;
            text-decoration: none;
            color: var(--text-dark);
            transition: all 0.2s;
        }
        .need-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--hover-shadow);
            color: var(--primary-color);
        }
        .need-card img {
            width: 48px; height: 48px;
            margin-bottom: 1rem;
        }

        /* Brand Chips */
        .brand-chip {
            display: inline-block;
            background: white;
            border: 1px solid #e5e7eb;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }
        .brand-chip:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* Pagination */
        .pagination .page-link {
            color: var(--text-dark);
            border: 1px solid #e5e7eb;
            margin: 0 2px;
            border-radius: 4px;
        }
        .pagination .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>

<!-- Spinner -->
<div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
    <div class="spinner-grow text-primary" role="status"></div>
</div>

<!-- Header -->
<div th:replace="~{client/layout/header :: header}"></div>

<!-- Modal Search -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content rounded-0">
            <div class="modal-header border-0">
                <h5 class="modal-title">Tìm kiếm sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex align-items-center flex-column">
                <div class="input-group w-75 mx-auto d-flex mb-4">
                    <input id="search-keyword" type="search" class="form-control p-3 shadow-none border-primary" placeholder="Nhập tên sản phẩm..." autocomplete="off">
                    <button id="btn-search-submit" class="btn btn-primary px-4">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
                <div id="search-results" class="w-75 list-group shadow-sm" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>
</div>

<!-- Banner -->
<div th:replace="~{client/layout/banner :: banner}"></div>

<!-- Chatbot -->
<div th:replace="~{client/layout/chatbot :: chatbot}"></div>


<!-- ===== MAIN CONTENT CONTAINER ===== -->
<div class="container py-5">

    <!-- 1. Category Icons -->
    <section>
        <div class="category-nav-bar">
            <a th:href="@{/products(keyword='Laptop')}" class="category-nav-item active">
                <i class="fas fa-laptop"></i><span>Laptop</span>
            </a>
            <a th:href="@{/products(keyword='PC')}" class="category-nav-item">
                <i class="fas fa-desktop"></i><span>PC</span>
            </a>
            <a th:href="@{/products(keyword='Man hinh')}" class="category-nav-item">
                <i class="fas fa-tv"></i><span>Màn hình</span>
            </a>
            <a th:href="@{/products(keyword='Linh kien')}" class="category-nav-item">
                <i class="fas fa-microchip"></i><span>Linh kiện</span>
            </a>
            <a th:href="@{/products(keyword='May in')}" class="category-nav-item">
                <i class="fas fa-print"></i><span>Máy in</span>
            </a>
            <a th:href="@{/products(keyword='Phu kien')}" class="category-nav-item">
                <i class="fas fa-keyboard"></i><span>Phụ kiện</span>
            </a>
        </div>
    </section>

    <!-- 2. Promo Banners -->
    <section>
        <div class="row g-4">
            <div class="col-md-6">
                <a href="#"><img src="https://placehold.co/600x150/111/FFF?text=Khuyen+Mai+Laptop+Gaming" class="img-fluid rounded-3 shadow-sm w-100" alt="Banner"></a>
            </div>
            <div class="col-md-6">
                <a href="#"><img src="https://placehold.co/600x150/007bff/FFF?text=Giam+Gia+Sinh+Vien" class="img-fluid rounded-3 shadow-sm w-100" alt="Banner"></a>
            </div>
        </div>
    </section>

    <!-- 3. Brand Filter -->
    <section>
        <h3 class="section-title">Thương hiệu nổi bật</h3>
        <div class="d-flex flex-wrap">
            <a th:href="@{/products(keyword='MacBook')}" class="brand-chip">MacBook</a>
            <a th:href="@{/products(keyword='ASUS')}" class="brand-chip">ASUS</a>
            <a th:href="@{/products(keyword='Lenovo')}" class="brand-chip">Lenovo</a>
            <a th:href="@{/products(keyword='MSI')}" class="brand-chip">MSI</a>
            <a th:href="@{/products(keyword='Acer')}" class="brand-chip">Acer</a>
            <a th:href="@{/products(keyword='HP')}" class="brand-chip">HP</a>
            <a th:href="@{/products(keyword='Dell')}" class="brand-chip">Dell</a>
        </div>
    </section>

    <!-- 4. Needs Filter -->
    <section>
        <h3 class="section-title">Chọn theo nhu cầu</h3>
        <div class="row g-3">
            <div class="col-6 col-md-4 col-lg-2">
                <a th:href="@{/products(keyword='Van phong')}" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/3003/3003202.png" alt="Văn phòng">
                    <span>Văn phòng</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a th:href="@{/products(keyword='Gaming')}" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/808/808439.png" alt="Gaming">
                    <span>Gaming</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a th:href="@{/products(keyword='Mong nhe')}" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/2919/2919600.png" alt="Mỏng nhẹ">
                    <span>Mỏng nhẹ</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a th:href="@{/products(keyword='Do hoa')}" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/1995/1995485.png" alt="Đồ họa">
                    <span>Đồ họa</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a th:href="@{/products(keyword='Sinh vien')}" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/201/201614.png" alt="Sinh viên">
                    <span>Sinh viên</span>
                </a>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <a th:href="@{/products(keyword='Cao cap')}" class="need-card">
                    <img src="https://cdn-icons-png.flaticon.com/512/954/954591.png" alt="Cao cấp">
                    <span>Cao cấp</span>
                </a>
            </div>
        </div>
    </section>
</div>


<!-- ===== 5. GỢI Ý AI (Nền xám nhẹ) ===== -->
<div class="container-fluid py-5 bg-light" th:if="${recommendedProducts != null and not #lists.isEmpty(recommendedProducts)}">
    <div class="container">
        <h2 class="section-title text-center mb-4" th:text="${recommendTitle}">Gợi ý cho bạn</h2>

        <div class="owl-carousel product-carousel">
            <div class="item h-100" th:each="product : ${recommendedProducts}">
                <div class="card product-card h-100">
                    <div class="product-img-container">
                        <img th:src="@{'/images/product/' + ${product.image}}" class="card-img-top" th:alt="${product.name}">
                        <a href="#" class="btn-quick-view" data-bs-toggle="modal" data-bs-target="#quickViewModal"
                           th:attr="data-name=${product.name}, data-price=${product.price}, data-image=@{'/images/product/' + ${product.image}}, data-desc=${product.shortDesc}, data-id=${product.id}">
                            <i class="fa fa-eye"></i>
                        </a>
                        <span class="product-tag" th:text="${product.category != null ? product.category.name : 'Hot'}"></span>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title"><a th:href="@{'/product/' + ${product.id}}" th:text="${product.name}"></a></h5>
                        <p class="card-text text-truncate" th:text="${product.shortDesc}"></p>
                        <div class="mt-auto">
                            <p class="product-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></p>
                            <form th:action="@{/add-product-to-cart/{id}(id=${product.id})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button class="btn-add-to-cart" type="submit">
                                    <i class="fa fa-shopping-bag me-2"></i> Thêm vào giỏ
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- ===== 6. SẢN PHẨM MỚI (STICKY FILTER) ===== -->
<div class="container py-5">
    <h2 class="text-center fw-bold mb-4">Sản Phẩm Mới Nhất</h2>

    <!-- Sticky Filter Bar -->
    <div id="product-filter-bar" class="product-filter-bar text-center">
        <ul class="nav nav-pills d-inline-flex justify-content-center">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="pill" href="#tab-0">Tất cả</a>
            </li>
            <li class="nav-item" th:each="cat : ${categories}">
                <a class="nav-link" data-bs-toggle="pill" th:href="@{|#tab-${cat.id}|}" th:text="${cat.name}"></a>
            </li>
        </ul>
    </div>
    <div id="filter-placeholder" style="display:none;"></div>

    <!-- Tabs Content -->
    <div class="tab-content mt-4">
        <!-- Tab All -->
        <div id="tab-0" class="tab-pane fade show p-0 active">
            <div class="row g-4">
                <div class="col-md-6 col-lg-4 col-xl-3" th:each="product : ${products}">
                    <!-- CARD SẢN PHẨM (Copy y hệt ở trên) -->
                    <div class="card product-card h-100">
                        <div class="product-img-container">
                            <img th:src="@{'/images/product/' + ${product.image}}" class="card-img-top" th:alt="${product.name}">
                            <a href="#" class="btn-quick-view" data-bs-toggle="modal" data-bs-target="#quickViewModal"
                               th:attr="data-name=${product.name}, data-price=${product.price}, data-image=@{'/images/product/' + ${product.image}}, data-desc=${product.shortDesc}, data-id=${product.id}">
                                <i class="fa fa-eye"></i>
                            </a>
                            <span class="product-tag" th:text="${product.category != null ? product.category.name : 'Mới'}"></span>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title"><a th:href="@{'/product/' + ${product.id}}" th:text="${product.name}"></a></h5>
                            <p class="card-text text-truncate" th:text="${product.shortDesc}"></p>
                            <div class="mt-auto">
                                <p class="product-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></p>
                                <form th:action="@{/add-product-to-cart/{id}(id=${product.id})}" method="post">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button class="btn-add-to-cart" type="submit">
                                        <i class="fa fa-shopping-bag me-2"></i> Thêm vào giỏ
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Tabs -->
        <div th:each="cat : ${categories}" th:id="@{|tab-${cat.id}|}" class="tab-pane fade show p-0">
            <div class="row g-4">
                <div class="col-md-6 col-lg-4 col-xl-3"
                     th:each="product : ${products}"
                     th:if="${product.category != null and product.category.id == cat.id}">

                    <!-- CARD SẢN PHẨM (Copy y hệt) -->
                    <div class="card product-card h-100">
                        <div class="product-img-container">
                            <img th:src="@{'/images/product/' + ${product.image}}" class="card-img-top" th:alt="${product.name}">
                            <a href="#" class="btn-quick-view" data-bs-toggle="modal" data-bs-target="#quickViewModal"
                               th:attr="data-name=${product.name}, data-price=${product.price}, data-image=@{'/images/product/' + ${product.image}}, data-desc=${product.shortDesc}, data-id=${product.id}">
                                <i class="fa fa-eye"></i>
                            </a>
                            <span class="product-tag" th:text="${cat.name}"></span>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title"><a th:href="@{'/product/' + ${product.id}}" th:text="${product.name}"></a></h5>
                            <p class="card-text text-truncate" th:text="${product.shortDesc}"></p>
                            <div class="mt-auto">
                                <p class="product-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></p>
                                <form th:action="@{/add-product-to-cart/{id}(id=${product.id})}" method="post">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button class="btn-add-to-cart" type="submit">
                                        <i class="fa fa-shopping-bag me-2"></i> Thêm vào giỏ
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== PHÂN TRANG (Pagination) ===== -->
    <!-- Chỉ hiển thị nếu có totalPages > 1 -->
    <div class="d-flex justify-content-center mt-5" th:if="${totalPages != null and totalPages > 1}">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <!-- Nút Trước -->
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/(page=${currentPage - 1})}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                <!-- Các số trang -->
                <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                    th:classappend="${currentPage == i} ? 'active'">
                    <a class="page-link" th:href="@{/(page=${i})}" th:text="${i}">1</a>
                </li>

                <!-- Nút Sau -->
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{/(page=${currentPage + 1})}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>


<div th:replace="~{client/layout/feature :: feature}"></div>
<div th:replace="~{client/layout/footer :: footer}"></div>
<a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top"><i class="fa fa-arrow-up"></i></a>

<!-- Modal Quick View -->
<div class="modal fade" id="quickViewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 rounded-3">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold">Chi tiết sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-5">
                        <img id="quickViewImage" src="" class="img-fluid rounded w-100 object-fit-contain" alt="Product" style="max-height: 300px;">
                    </div>
                    <div class="col-md-7">
                        <h3 id="quickViewName" class="fw-bold mb-3"></h3>
                        <h4 id="quickViewPrice" class="text-danger fw-bold mb-3"></h4>
                        <p id="quickViewDesc" class="text-muted mb-4"></p>

                        <form id="quickViewForm" method="post" action="">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button class="btn btn-primary w-100 py-2 rounded-pill" type="submit">
                                <i class="fa fa-shopping-bag me-2"></i> Thêm vào giỏ ngay
                            </button>
                        </form>
                        <a href="#" id="quickViewFullDetails" class="btn btn-outline-secondary w-100 mt-2 py-2 rounded-pill">Xem chi tiết đầy đủ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/client/lib/easing/easing.min.js"></script>
<script src="/client/lib/waypoints/waypoints.min.js"></script>
<script src="/client/lib/lightbox/js/lightbox.min.js"></script>
<script src="/client/lib/owlcarousel/owl.carousel.min.js"></script>
<script src="/client/js/main.js"></script>

<script th:inline="javascript">
    /*<![CDATA[*/

    // 1. Quick View Logic
    var quickViewModal = document.getElementById('quickViewModal');
    quickViewModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var name = button.getAttribute('data-name');

        // Format giá tiền
        var rawPrice = button.getAttribute('data-price');
        var formattedPrice = new Intl.NumberFormat('vi-VN').format(rawPrice) + ' đ';

        var image = button.getAttribute('data-image');
        var desc = button.getAttribute('data-desc');
        var id = button.getAttribute('data-id');

        document.getElementById('quickViewName').textContent = name;
        document.getElementById('quickViewPrice').textContent = formattedPrice;
        document.getElementById('quickViewImage').src = image;
        document.getElementById('quickViewDesc').textContent = desc;
        document.getElementById('quickViewFullDetails').href = '/product/' + id;
        document.getElementById('quickViewForm').action = '/add-product-to-cart/' + id;
    });

    // 2. Sticky Filter & Owl Carousel
    (function ($) {
        $(window).scroll(function() {
            var header = $('.fixed-top');
            var filterBar = $('#product-filter-bar');
            var placeholder = $('#filter-placeholder');

            if (header.length && filterBar.length && placeholder.length) {
                var headerHeight = header.outerHeight() || 90;
                var filterBarOffset = filterBar.offset().top;

                if (!filterBar.hasClass('sticky-filter')) {
                   placeholder.height(filterBar.outerHeight());
                }

                if ($(window).scrollTop() > (filterBarOffset - headerHeight)) {
                    filterBar.addClass('sticky-filter');
                    filterBar.css('top', headerHeight + 'px');
                    placeholder.show();
                } else {
                    filterBar.removeClass('sticky-filter');
                    placeholder.hide();
                }
            }
        });

        $('.product-carousel').owlCarousel({
            autoplay: true,
            smartSpeed: 1000,
            center: false,
            dots: true,
            loop: true,
            margin: 25,
            nav : false,
            responsiveClass: true,
            responsive: { 0:{items:1}, 576:{items:1}, 768:{items:2}, 992:{items:3}, 1200:{items:4} }
        });

        // 3. Search AJAX
        let debounceTimer;
        $("#search-keyword").on("input", function () {
             const keyword = $(this).val().trim();
             clearTimeout(debounceTimer);
             debounceTimer = setTimeout(() => {
                 if (keyword.length >= 2) {
                    $.ajax({
                        url: "/api/search",
                        type: "GET",
                        data: { keyword: keyword },
                        success: function(data) {
                             const resultsDiv = $("#search-results");
                             if (data.length === 0) {
                                 resultsDiv.html("<p class='text-center text-muted p-2'>Không tìm thấy kết quả</p>");
                             } else {
                                 let html = data.map(p => `
                                     <a href="/product/${p.id}" class="list-group-item list-group-item-action border-0 border-bottom">
                                         <div class="d-flex align-items-center">
                                             <div class="ms-2">
                                                 <h6 class="mb-0 text-dark">${p.name}</h6>
                                                 <small class="text-muted">${p.shortDesc}</small>
                                             </div>
                                         </div>
                                     </a>
                                 `).join('');
                                 resultsDiv.html(html);
                             }
                        }
                    });
                 } else {
                    $("#search-results").html("");
                 }
             }, 500);
        });

        // Nút tìm kiếm
        $("#btn-search-submit").click(function() {
            const keyword = $("#search-keyword").val().trim();
            if(keyword) {
                window.location.href = "/products?keyword=" + encodeURIComponent(keyword);
            }
        });
        $("#search-keyword").keypress(function(e) {
            if(e.which == 13) {
                const keyword = $(this).val().trim();
                if(keyword) {
                     window.location.href = "/products?keyword=" + encodeURIComponent(keyword);
                }
            }
        });

    })(jQuery);
    /*]]>*/
</script>

</body>
</html>